<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Wedding by elden1337</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Wedding</h1>
      <h2 class="project-tagline">My first personal ASP.NET MVC-project, made for my wedding.</h2>
      <a href="https://github.com/elden1337/wedding" class="btn">View on GitHub</a>
      <a href="https://github.com/elden1337/wedding/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/elden1337/wedding/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="wedding" class="anchor" href="#wedding" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Wedding</h1>

<p>My first personal MVC-project was this wedding site. 
As a product owner, I do see a lot of code in my everyday job, but don't get to code much myself.<br>
The aim was to create an MVC-application in ASP.NET to learn basic setups of the trade, plus to provide myself and Lisa with an easy-to-use platform as a wedding RSVP-application with infos, images etc.<br><br></p>

<h3>
<a id="phase-1" class="anchor" href="#phase-1" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Phase 1</h3>

<p>In practical terms, this meant setting up an SQL-server database in Azure, where I created a set of guests, and combined them into couples and families by adding a token, which was then sent to them on the back of their invitation.<br>
Upon login in to the site via one of the external providers used (Facebook, Microsoft, Google) or by creating a local account, they were prompted with an input where the token was added, which then gave them access to RSVP to their whole family.<br>
The RSVP itself was editable, so the token was stored together with the userid in the ASPNetUsers-table.<br><br></p>

<h3>
<a id="phase-2" class="anchor" href="#phase-2" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Phase 2</h3>

<p>Once the project was up and running, and the RSVP's started flowing in, I began creating an image-uploading service. To do this, I created a blog-storage on Azure, and an upload-page in my application. However, the images uploaded were too large to show on the web, so to retain the original-size, as well as providing fast-loading copies, I created an Azure-webjob and a queue which resized the images. I then added the resized-uri to the database and showed that in the views.
<br><br>
Part of the first upload to blob:<br></p>

<div class="highlight highlight-source-cs"><pre>
 <span class="pl-k">for</span> (<span class="pl-k">int</span> i = <span class="pl-c1">0</span>; i &lt; files.Count(); i++)
 {
     <span class="pl-k">var</span> file = files[i];

     <span class="pl-k">var</span> exifcreateddatetime = <span class="pl-k">new</span> DateTime(<span class="pl-c1">2020</span>, <span class="pl-c1">3</span>, <span class="pl-c1">24</span>, <span class="pl-c1">8</span>, <span class="pl-c1">43</span>, <span class="pl-c1">00</span>);
     String fileextention;
     fileextention = Path.GetExtension(file.FileName).ToLower();

     String uploadtime = DateTime.Now.ToString(<span class="pl-s"><span class="pl-pds">"</span>yyyy-MM-dd-HH:mm:ss.fff<span class="pl-pds">"</span></span>);

     CloudBlockBlob blockBlob = container.GetBlockBlobReference(uploadtime + fileextention);

     blockBlob.UploadFromStream(file.InputStream);
</pre></div>

<p><br>
In order to read the EXIF-data from the uploaded images (for sorting on date-taken), I had to play around quite a bit. I solved it like this:<br></p>

<div class="highlight highlight-source-cs"><pre> file.InputStream.Position = <span class="pl-c1">0</span>;

        <span class="pl-k">byte</span>[] imageData = <span class="pl-k">new</span> <span class="pl-k">byte</span>[file.ContentLength];

        file.InputStream.Read(imageData, <span class="pl-c1">0</span>, file.ContentLength);

        <span class="pl-k">using</span> (Stream inputStream = file.InputStream)
        {
            MemoryStream ms = inputStream <span class="pl-k">as</span> MemoryStream;
            <span class="pl-k">if</span> (ms == <span class="pl-c1">null</span>)
            {
                ms = <span class="pl-k">new</span> MemoryStream(imageData);
                StreamReader sr = <span class="pl-k">new</span> StreamReader(ms);

                inputStream.CopyTo(ms);
            }

            Image originalImage = Image.FromStream(ms);

            exifcreateddatetime = <span class="pl-k">new</span> DateTime(<span class="pl-c1">2020</span>, <span class="pl-c1">3</span>, <span class="pl-c1">24</span>, <span class="pl-c1">8</span>, <span class="pl-c1">43</span>, <span class="pl-c1">00</span>);

            <span class="pl-k">int</span> DateTakenValue = <span class="pl-c1">0x9003</span>; <span class="pl-c">//36867;</span>
            CultureInfo provider = CultureInfo.InvariantCulture;

            <span class="pl-k">if</span> (!originalImage.PropertyIdList.Contains(DateTakenValue))
            {
                exifcreateddatetime = <span class="pl-k">new</span> DateTime(<span class="pl-c1">2020</span>, <span class="pl-c1">3</span>, <span class="pl-c1">24</span>, <span class="pl-c1">8</span>, <span class="pl-c1">43</span>, <span class="pl-c1">00</span>);
            }
            <span class="pl-k">else</span>
            {
                <span class="pl-k">string</span> dateTakenTag = System.Text.Encoding.ASCII.GetString(originalImage.GetPropertyItem(DateTakenValue).Value);
                <span class="pl-k">string</span>[] parts = dateTakenTag.Split(<span class="pl-s"><span class="pl-pds">'</span>:<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span> <span class="pl-pds">'</span></span>);
                <span class="pl-k">int</span> year = <span class="pl-k">int</span>.Parse(parts[<span class="pl-c1">0</span>]);
                <span class="pl-k">int</span> month = <span class="pl-k">int</span>.Parse(parts[<span class="pl-c1">1</span>]);
                <span class="pl-k">int</span> day = <span class="pl-k">int</span>.Parse(parts[<span class="pl-c1">2</span>]);
                <span class="pl-k">int</span> hour = <span class="pl-k">int</span>.Parse(parts[<span class="pl-c1">3</span>]);
                <span class="pl-k">int</span> minute = <span class="pl-k">int</span>.Parse(parts[<span class="pl-c1">4</span>]);
                <span class="pl-k">int</span> second = <span class="pl-k">int</span>.Parse(parts[<span class="pl-c1">5</span>]);

                exifcreateddatetime = <span class="pl-k">new</span> DateTime(year, month, day, hour, minute, second);
            }
        }
</pre></div>

<p><br>
A quick schema of the upload and image-resize through webjob <em>(webjob not present in this repo)</em><br>
<img src="/Readmefiles/azure_webjob_schema.jpg" alt="webjob schema"><br><br></p>

<p>I then uploaded parameters to the media-table in the database and showed it on an admin-page for approval, before exposing the images to all the guests.<br></p>

<hr>

<p><br>
What I learnt and experimented with during the project:</p>

<ul>
<li>GoogleMaps-styling (see Views/Start/Info)</li>
<li>MDL-styling framework utilized throughout</li>
<li>Responsive design with viewports Tablet, Phone and Desktop in mind</li>
<li>Entity Framework</li>
<li>SQL-database setup</li>
<li>C#</li>
<li>ASP.NET</li>
<li>Some Jquery</li>
<li>Azure webjobs <em>(not in this repo)</em>
</li>
<li>Azure blobstorage and queue <em>(not in this repo)</em>
</li>
</ul>

<p>What I experimented with somewhat but didn't finalize:</p>

<ul>
<li>Google Matrix API, to be able to create a commuter-service for the guests</li>
<li>A toast-master chat which was supposed to be hashed to not be visible in database (to me, the groom). See the Toast-section of the repo.</li>
<li>Various small API's that I was too unskilled to implement</li>
</ul>

<h2>
<a id="screenshots" class="anchor" href="#screenshots" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Screenshots</h2>

<p><br><br>
<img src="/Readmefiles/frontpage.JPG" alt="Desktop Frontpage">
The startpage on desktop.<br></p>

<p><img src="/Readmefiles/mobilestart.JPG" alt="Mobile Frontpage w menu open"><br>
The startpage on mobile portrait, with MDL-mobile menu opened.<br></p>

<p><img src="/Readmefiles/guest.JPG" alt="Part of the guest-form"><br>
Part of the guest-form where they filled out their contact info, food prefs and lodging prefs (swedish).<br></p>

<p><img src="/Readmefiles/bilder.JPG" alt="Desktop Image-page w uploadform opened">
The image-page on desktop, with image-uploadform opened.<br>
<br><br></p>

<h2>
<a id="references-some-of-them" class="anchor" href="#references-some-of-them" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>References (some of them):</h2>

<ul>
<li><a href="https://getmdl.io/">https://getmdl.io/</a></li>
<li><a href="https://azure.microsoft.com/sv-se/documentation/articles/websites-dotnet-webjobs-sdk-get-started/">https://azure.microsoft.com/sv-se/documentation/articles/websites-dotnet-webjobs-sdk-get-started/</a></li>
<li><a href="http://stackoverflow.com/questions/36869097/azure-webjobs-blob-trigger-multiple-resizes">http://stackoverflow.com/questions/36869097/azure-webjobs-blob-trigger-multiple-resizes</a></li>
</ul>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/elden1337/wedding">Wedding</a> is maintained by <a href="https://github.com/elden1337">elden1337</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
